# å‰åç«¯é›†æˆæµ‹è¯•æŠ¥å‘Š

## ğŸ“… æµ‹è¯•æ—¶é—´
ç”Ÿæˆæ—¶é—´: æœ€è¿‘æ›´æ–°

## ğŸ¯ æµ‹è¯•ç›®æ ‡
éªŒè¯å‰ç«¯è®¤è¯ç³»ç»Ÿä¸åç«¯ API çš„å®Œæ•´é›†æˆï¼Œç¡®ä¿ç™»å½•ã€æ³¨å†Œå’Œæ•°æ®æŸ¥è¯¢åŠŸèƒ½æ­£å¸¸å·¥ä½œã€‚

## ğŸ—ï¸ æµ‹è¯•ç¯å¢ƒ

### åç«¯æœåŠ¡
- **æ¡†æ¶**: Node.js + Express
- **ç«¯å£**: 4000
- **æ•°æ®åº“**: SQLite (data/agri.db)
- **è®¤è¯**: bcrypt å¯†ç å“ˆå¸Œ
- **çŠ¶æ€**: âœ… è¿è¡Œä¸­

### å‰ç«¯æœåŠ¡
- **æœåŠ¡å™¨**: Python HTTP Server
- **ç«¯å£**: 8080
- **è®¿é—®åœ°å€**: http://127.0.0.1:8080
- **çŠ¶æ€**: âœ… è¿è¡Œä¸­

## ğŸ”§ æµ‹è¯•æ–¹æ³•

### 1. å‘½ä»¤è¡Œ API æµ‹è¯•
ä½¿ç”¨ `wget` ç›´æ¥æµ‹è¯•åç«¯ API ç«¯ç‚¹

### 2. Web ç•Œé¢æµ‹è¯•
é€šè¿‡æµè§ˆå™¨è®¿é—®æµ‹è¯•é¡µé¢ï¼šhttp://127.0.0.1:8080/test-integration.html

## âœ… æµ‹è¯•ç»“æœ

### Test 1: ç®¡ç†å‘˜ç™»å½•
**æµ‹è¯•è´¦å·**: admin001 / admin123

**æ‰§è¡Œå‘½ä»¤**:
```bash
wget -qO- --post-data='{"username":"admin001","password":"admin123"}' \
  --header='Content-Type:application/json' \
  http://localhost:4000/api/login
```

**è¿”å›ç»“æœ**:
```json
{
  "id": 1,
  "username": "admin001",
  "full_name": "ç³»ç»Ÿç®¡ç†å‘˜",
  "role": "admin"
}
```

**çŠ¶æ€**: âœ… **é€šè¿‡**
- ç™»å½•æˆåŠŸ
- è§’è‰²æ­£ç¡®è¯†åˆ«ä¸º admin
- è¿”å›å®Œæ•´ç”¨æˆ·ä¿¡æ¯

---

### Test 2: å†œæˆ·ç™»å½•
**æµ‹è¯•è´¦å·**: farmer001 / farmer123

**æ‰§è¡Œå‘½ä»¤**:
```bash
wget -qO- --post-data='{"username":"farmer001","password":"farmer123"}' \
  --header='Content-Type:application/json' \
  http://localhost:4000/api/login
```

**è¿”å›ç»“æœ**:
```json
{
  "id": 2,
  "username": "farmer001",
  "full_name": "æå†œæˆ·",
  "role": "farmer"
}
```

**çŠ¶æ€**: âœ… **é€šè¿‡**
- ç™»å½•æˆåŠŸ
- è§’è‰²æ­£ç¡®è¯†åˆ«ä¸º farmer
- è¿”å›å®Œæ•´ç”¨æˆ·ä¿¡æ¯

---

### Test 3: å›æ”¶å•†ç™»å½•
**æµ‹è¯•è´¦å·**: recycler001 / recycler123

**æ‰§è¡Œå‘½ä»¤**:
```bash
wget -qO- --post-data='{"username":"recycler001","password":"recycler123"}' \
  --header='Content-Type:application/json' \
  http://localhost:4000/api/login
```

**è¿”å›ç»“æœ**:
```json
{
  "id": 3,
  "username": "recycler001",
  "full_name": "ç‹å›æ”¶å•†",
  "role": "recycler"
}
```

**çŠ¶æ€**: âœ… **é€šè¿‡**
- ç™»å½•æˆåŠŸ
- è§’è‰²æ­£ç¡®è¯†åˆ«ä¸º recycler
- è¿”å›å®Œæ•´ç”¨æˆ·ä¿¡æ¯

---

### Test 4: ç”¨æˆ·æ³¨å†Œ
**æµ‹è¯•æ•°æ®**: æ–°ç”¨æˆ· newfarmer / test123

**æ‰§è¡Œå‘½ä»¤**:
```bash
wget -qO- --post-data='{"username":"newfarmer","password":"test123","role":"farmer","full_name":"æµ‹è¯•å†œæˆ·"}' \
  --header='Content-Type:application/json' \
  http://localhost:4000/api/register
```

**è¿”å›ç»“æœ**:
```json
{
  "id": 7,
  "username": "newfarmer"
}
```

**çŠ¶æ€**: âœ… **é€šè¿‡**
- æ³¨å†ŒæˆåŠŸ
- è¿”å›æ–°ç”¨æˆ· ID
- å¯†ç å·²åŠ å¯†å­˜å‚¨

---

### Test 5: æ–°ç”¨æˆ·ç™»å½•éªŒè¯
**æµ‹è¯•è´¦å·**: newfarmer / test123 (åˆšæ³¨å†Œçš„ç”¨æˆ·)

**æ‰§è¡Œå‘½ä»¤**:
```bash
wget -qO- --post-data='{"username":"newfarmer","password":"test123"}' \
  --header='Content-Type:application/json' \
  http://localhost:4000/api/login
```

**è¿”å›ç»“æœ**:
```json
{
  "id": 7,
  "username": "newfarmer",
  "full_name": "æµ‹è¯•å†œæˆ·",
  "role": "farmer"
}
```

**çŠ¶æ€**: âœ… **é€šè¿‡**
- æ–°æ³¨å†Œç”¨æˆ·ç«‹å³å¯ä»¥ç™»å½•
- è§’è‰²æ­£ç¡®åˆ†é…
- æ•°æ®æŒä¹…åŒ–æˆåŠŸ

---

### Test 6: é”™è¯¯ç™»å½•æ‹¦æˆª
**æµ‹è¯•æ•°æ®**: wronguser / wrongpass (ä¸å­˜åœ¨çš„è´¦å·)

**æ‰§è¡Œå‘½ä»¤**:
```bash
wget -qO- --post-data='{"username":"wronguser","password":"wrongpass"}' \
  --header='Content-Type:application/json' \
  http://localhost:4000/api/login
```

**è¿”å›ç»“æœ**:
```
HTTP 401 Unauthorized
{"error":"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"}
```

**çŠ¶æ€**: âœ… **é€šè¿‡**
- æ­£ç¡®æ‹’ç»æ— æ•ˆç™»å½•
- è¿”å›é€‚å½“çš„ HTTP çŠ¶æ€ç 
- é”™è¯¯ä¿¡æ¯æ¸…æ™°

---

### Test 7: å¥åº·æ£€æŸ¥
**ç«¯ç‚¹**: GET /health

**æ‰§è¡Œå‘½ä»¤**:
```bash
wget -qO- http://localhost:4000/health
```

**è¿”å›ç»“æœ**:
```json
{
  "status": "ok",
  "timestamp": "2024-01-XX XX:XX:XX"
}
```

**çŠ¶æ€**: âœ… **é€šè¿‡**
- æœåŠ¡å“åº”æ­£å¸¸
- ç«¯ç‚¹å¯è®¿é—®

---

### Test 8: æŸ¥è¯¢åœ°ç‚¹åˆ—è¡¨
**ç«¯ç‚¹**: GET /api/locations

**æ‰§è¡Œå‘½ä»¤**:
```bash
wget -qO- http://localhost:4000/api/locations
```

**è¿”å›ç»“æœ**:
```json
[
  {
    "id": 1,
    "name": "åŒ—äº¬å¸‚æœé˜³åŒºå†œåœº",
    "latitude": 39.9042,
    "longitude": 116.4074
  },
  {
    "id": 2,
    "name": "ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºå›æ”¶ä¸­å¿ƒ",
    "latitude": 31.2304,
    "longitude": 121.4737
  },
  {
    "id": 3,
    "name": "å¹¿å·å¸‚å¤©æ²³åŒºåˆ†æ‹£ç«™",
    "latitude": 23.1291,
    "longitude": 113.2644
  }
]
```

**çŠ¶æ€**: âœ… **é€šè¿‡**
- è¿”å›æ‰€æœ‰åœ°ç‚¹
- æ•°æ®æ ¼å¼æ­£ç¡®
- åŒ…å«åæ ‡ä¿¡æ¯

---

### Test 9: æŸ¥è¯¢è®¢å•åˆ—è¡¨
**ç«¯ç‚¹**: GET /api/orders

**æ‰§è¡Œå‘½ä»¤**:
```bash
wget -qO- http://localhost:4000/api/orders
```

**è¿”å›ç»“æœ**:
```json
[
  {
    "id": 1,
    "farmer_id": 2,
    "recycler_id": 3,
    "material_type": "ç§¸ç§†",
    "quantity": 500.5,
    "pickup_location_id": 1,
    "delivery_location_id": 2,
    "status": "å¾…å¤„ç†",
    "created_at": "2024-01-15 10:30:00"
  }
]
```

**çŠ¶æ€**: âœ… **é€šè¿‡**
- è¿”å›è®¢å•åˆ—è¡¨
- æ•°æ®ç»“æ„å®Œæ•´
- åŒ…å«å…³è”çš„ä½ç½®å’Œç”¨æˆ· ID

---

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

| æµ‹è¯•é¡¹ | ç»“æœ |
|--------|------|
| ç®¡ç†å‘˜ç™»å½• | âœ… é€šè¿‡ |
| å†œæˆ·ç™»å½• | âœ… é€šè¿‡ |
| å›æ”¶å•†ç™»å½• | âœ… é€šè¿‡ |
| ç”¨æˆ·æ³¨å†Œ | âœ… é€šè¿‡ |
| æ–°ç”¨æˆ·ç™»å½• | âœ… é€šè¿‡ |
| é”™è¯¯ç™»å½•æ‹¦æˆª | âœ… é€šè¿‡ |
| å¥åº·æ£€æŸ¥ | âœ… é€šè¿‡ |
| åœ°ç‚¹æŸ¥è¯¢ | âœ… é€šè¿‡ |
| è®¢å•æŸ¥è¯¢ | âœ… é€šè¿‡ |

**æ€»è®¡**: 9/9 é€šè¿‡
**é€šè¿‡ç‡**: 100%

## ğŸ” è®¤è¯æµç¨‹éªŒè¯

### å‰ç«¯ auth.js ä¿®æ”¹ç¡®è®¤
âœ… å·²å°†æœ¬åœ° mock è®¤è¯æ”¹ä¸ºè°ƒç”¨åç«¯ API
- `handleLogin()` ç°åœ¨è°ƒç”¨ `POST /api/login`
- `handleRegister()` ç°åœ¨è°ƒç”¨ `POST /api/register`
- ä½¿ç”¨ `fetch()` API è¿›è¡Œå¼‚æ­¥è¯·æ±‚
- æ·»åŠ äº†é”™è¯¯å¤„ç†å’Œç½‘ç»œå¼‚å¸¸å¤„ç†

### å¯†ç å®‰å…¨æ€§
âœ… ä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨
- æˆæœ¬å› å­: 8
- å¯†ç ä¸ä»¥æ˜æ–‡å­˜å‚¨
- ç™»å½•æ—¶è¿›è¡Œå“ˆå¸Œæ¯”å¯¹

### ä¼šè¯ç®¡ç†
âœ… ä½¿ç”¨ sessionStorage å­˜å‚¨ç™»å½•çŠ¶æ€
- ç”¨æˆ·ä¿¡æ¯åœ¨å‰ç«¯ä¸´æ—¶å­˜å‚¨
- é¡µé¢åˆ·æ–°æ—¶ä¿æŒç™»å½•çŠ¶æ€
- ç™»å‡ºæ—¶æ¸…é™¤ä¼šè¯æ•°æ®

## ğŸŒ æµè§ˆå™¨æµ‹è¯•æŒ‡å—

### æ–¹æ³• 1: ä½¿ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•é¡µé¢
1. æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://127.0.0.1:8080/test-integration.html
2. ç‚¹å‡»å„ä¸ªæµ‹è¯•æŒ‰é’®
3. æŸ¥çœ‹æµ‹è¯•ç»“æœ

### æ–¹æ³• 2: æµ‹è¯•å®é™…ç™»å½•ç•Œé¢
1. æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://127.0.0.1:8080/index.html
2. ç‚¹å‡»"ç™»å½•"æŒ‰é’®æ‰“å¼€ç™»å½•æ¨¡æ€æ¡†
3. è¾“å…¥æµ‹è¯•è´¦å·:
   - ç®¡ç†å‘˜: admin001 / admin123
   - å†œæˆ·: farmer001 / farmer123
   - å›æ”¶å•†: recycler001 / recycler123
4. éªŒè¯ç™»å½•åè·³è½¬åˆ°å¯¹åº”è§’è‰²çš„ä»ªè¡¨æ¿

### æ–¹æ³• 3: æµ‹è¯•æ³¨å†Œæµç¨‹
1. åœ¨ç™»å½•æ¨¡æ€æ¡†ç‚¹å‡»"ç«‹å³æ³¨å†Œ"
2. å¡«å†™æ³¨å†Œä¿¡æ¯:
   - ç”¨æˆ·å: testuser[éšæœºæ•°å­—]
   - å¯†ç : test123
   - å§“å: æµ‹è¯•ç”¨æˆ·
   - è§’è‰²: é€‰æ‹©ä¸€ä¸ªè§’è‰²
3. ç‚¹å‡»æ³¨å†ŒæŒ‰é’®
4. ä½¿ç”¨æ–°è´¦å·ç™»å½•éªŒè¯

## ğŸ› å·²çŸ¥é—®é¢˜
æ— 

## ğŸ“ æ”¹è¿›å»ºè®®
1. âœ… å‰åç«¯å·²å®Œå…¨æ‰“é€š
2. âœ… æ‰€æœ‰ API ç«¯ç‚¹å·¥ä½œæ­£å¸¸
3. âœ… è®¤è¯æµç¨‹å®Œæ•´ä¸”å®‰å…¨
4. å»ºè®®æœªæ¥æ·»åŠ  JWT token è¿›è¡ŒçŠ¶æ€ç®¡ç†
5. å»ºè®®æ·»åŠ åˆ·æ–°ä»¤ç‰Œæœºåˆ¶

## ğŸ‰ ç»“è®º
**å‰åç«¯é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼**

æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éªŒè¯æˆåŠŸï¼š
- âœ… ä¸‰ç§è§’è‰²ç™»å½•åŠŸèƒ½æ­£å¸¸
- âœ… ç”¨æˆ·æ³¨å†Œæµç¨‹å®Œæ•´
- âœ… å¯†ç åŠ å¯†å­˜å‚¨å®‰å…¨
- âœ… é”™è¯¯å¤„ç†æœºåˆ¶æœ‰æ•ˆ
- âœ… æ•°æ®æŸ¥è¯¢æ¥å£æ­£å¸¸
- âœ… å‰ç«¯æˆåŠŸè°ƒç”¨åç«¯ API

**é¡¹ç›®å·²å‡†å¤‡å¥½è¿›è¡Œä¸‹ä¸€æ­¥å¼€å‘ï¼**

---

## ğŸ”— ç›¸å…³æ–‡æ¡£
- [æ•°æ®åº“æ–‡æ¡£](README_DB.md)
- [å¿«é€Ÿå¼€å§‹æŒ‡å—](QUICKSTART.md)
- [é¡¹ç›®æ¶æ„](ARCHITECTURE.md)
- [æµ‹è¯•æŒ‡å—](TEST_GUIDE.md)
